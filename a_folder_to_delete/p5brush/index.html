<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Brush Example</title>
    <script src="https://cdn.jsdelivr.net/npm/p5@1.7.0/lib/p5.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/p5.brush@1.1.1/dist/p5.brush.js"></script>
    <script>
      let palette = ["#A87676", "#CA8787", "#E1ACAC", "#FFD0D0"];
      let currentBrush = "colorful";
      let linesDrawn = 0;
      let maxLines = Math.floor(Math.random() * 10) + 1;
      let drawingActive = true;

      function setup() {
        createCanvas(1500, 1500, WEBGL);
        angleMode(DEGREES);
        background("#fffceb");
        brush.scaleBrushes(1.5);
        brush.field("seabed");

        brush.add("colorful", {
          type: "custom",
          weight: 5,
          vibration: 0.08,
          opacity: 23,
          spacing: 0.6,
          blend: true,
          pressure: {
            type: "standard",
            min_max: [1.35, 1],
            curve: [0.35, 0.25],
          },
          tip: (_m) => {
            let c = random(palette);
            _m.fill(c);
            _m.noStroke();
            _m.rotate(45);
            _m.rect(-1.5, -1.5, 3, 3);
            _m.rect(1, 1, 1, 1);
          },
          rotate: "natural",
        });

        setTimeout(() => {
          drawingActive = false;
        }, 5000);
      }

      function draw() {
        frameRate(10);
        translate(-width / 2, -height / 2);

        if (drawingActive && linesDrawn < maxLines) {
          brush.set(currentBrush, random(palette), 1);
          brush.flowLine(random(width), random(height), random(300, 800), random(0, 360));
          linesDrawn++;
        } else if (!drawingActive) {
          noLoop(); // Stop the draw loop
        } else {
          linesDrawn = 0;
          maxLines = Math.floor(Math.random() * 10) + 1;
        }
      }

      function colorful() {
        currentBrush = "colorful";
      }
    </script>
  </head>
  <body>
    <button onclick="colorful()">Colorful</button>
  </body>
</html>
